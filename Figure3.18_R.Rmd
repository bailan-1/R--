---
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r ç”Ÿæˆæ•°æ®}
#ç”Ÿæˆæ•°æ®
genXY <- function (rho =-0.5,#ç›¸å…³ç³»æ•°
                  N =100,   #æ ·æœ¬æ•°é‡
                  beta = c(4,2))#çœŸå®ç³»æ•°
{
  Sigma = matrix(c(1,rho,rho,1),2,2)#ç”Ÿæˆåæ–¹å·®çŸ©é˜µ
  library(MASS)#è¯¥åŒ…æä¾›äº†ç”Ÿæˆå¤šå…ƒæ­£æ€åˆ†å¸ƒæ•°æ®çš„å‡½æ•°mvrnorm
  X = mvrnorm(N,c(0,0),Sigma)#ç”Ÿæˆ ğ‘ä¸ªæ ·æœ¬çš„äºŒç»´å¤šå…ƒæ­£æ€åˆ†å¸ƒæ•°æ®ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ ·æœ¬æ•°é‡ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å‡å€¼å‘é‡ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯åæ–¹å·®çŸ©é˜µ
  Y = X[,1]*beta[1]+X[,2]*beta[2]#æ ¹æ®Xç”ŸæˆYæ•°æ®
  return(list(X=X,Y=Y))
  
}
  
```

#å…­ç§æ–¹æ³• ##æœ€å°äºŒä¹˜

```{r æœ€å°äºŒä¹˜}
set.seed(1234)
data <- genXY()
X <- data$X
Y <- data$Y
ols.fit = lm(Y~0+X)
ols.beta = coef(ols.fit)#coefç”¨äºæå–å›å½’ç³»æ•°ï¼Œæ­¤æ—¶ä¸ºåˆ—å‘é‡
ols.beta = as.matrix(t(ols.beta))#è½¬ç½®åå†è½¬æ¢ä¸ºçŸ©é˜µçš„å½¢å¼
```

##lasso

```{r lasso}
#åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«100ä¸ªå€¼çš„åºåˆ—ï¼Œä»10^10~10^-2å‡åŒ€åˆ†å¸ƒï¼Œä½œä¸ºæƒ©ç½šå‚æ•°çš„ç½‘æ ¼
#install.packages("glmnet")
grid = 10^seq(10,-2,length=100)
library(glmnet)#æä¾›äº†Lassoå’ŒRidgeå›å½’ç­‰å¹¿ä¹‰çº¿æ€§æ¨¡å‹çš„å®ç°
#å‚æ•°è§£é‡Š
#Xï¼šè‡ªå˜é‡çŸ©é˜µ
#Yï¼šå“åº”å˜é‡å‘é‡
#alphaï¼Œè¡¨ç¤ºLassoå’ŒRidgeçš„æ··åˆç¨‹åº¦ï¼Œ1è¡¨ç¤ºçº¯Lassoï¼Œ0è¡¨ç¤ºçº¯Ridge
#lambda = grid è¡¨ç¤ºæƒ©ç½šå‚æ•°çš„ç½‘æ ¼
lasso.fit = glmnet(X,Y,alpha = 1,lambada = grid)
#è·å¾—å‚æ•°å¹¶å°†å…¶è½¬åŒ–ä¸ºçŸ©é˜µ
lasso.beta = as.matrix(lasso.fit$beta)
lasso.beta = t(lasso.beta)
#å¯¹çŸ©é˜µçš„åˆ—è¿›è¡Œé‡æ–°å‘½å
attr(lasso.beta,"dimnames") = list(NULL,c("X1","X2"))
```

##rideg

```{r ridge}
#åŒlassoï¼ŒæŠŠalphaå†™æˆ0å³å¯
ridge.fit = glmnet(X,Y,alpha = 0,lambada = grid)
ridge.beta = as.matrix(ridge.fit$beta)
ridge.beta = t(ridge.beta)
attr(ridge.beta,"dimnames") = list(NULL,c("X1","X2"))
```

##ä¸»æˆåˆ†å›å½’

```{r ä¸»æˆåˆ†å›å½’}
#install.packages("pls")
library(pls)
#scaleè¡¨ç¤ºæ˜¯å¦å¯¹è‡ªå˜é‡è¿›è¡Œæ ‡å‡†åŒ–
pcr.fit = pcr(Y~X,scale = FALSE)

pcr.beta = pcr.fit$coefficients#æå–çš„æ˜¯ä¸€ä¸ªå¤šç»´æ•°ç»„ï¼ŒåŒ…å«ä¸åŒä¸»æˆåˆ†æ•°é‡ä¸‹çš„å›å½’ç³»æ•°
#å°†å›å½’ç³»æ•°çŸ©é˜µæŒ‰è¡Œç»‘å®šåœ¨ä¸€èµ·ï¼Œå¹¶åœ¨æœ€å‰é¢æ·»åŠ ä¸€è¡Œc(0,0)ï¼Œè¡¨ç¤ºä½¿ç”¨é›¶ä¸ªä¸»æˆåˆ†æ—¶çš„å›å½’ç³»æ•°
#æå–ä½¿ç”¨ä¸€ä¸ªä¸»æˆåˆ†æ—¶çš„å›å½’ç³»æ•°
#æå–ä½¿ç”¨ä¸¤ä¸ªä¸»æˆåˆ†æ—¶çš„å›å½’ç³»æ•°
pcr.beta = rbind(c(0,0),pcr.beta[,,1],pcr.beta[,,2])
```

##åæœ€å°äºŒä¹˜æ³•

```{r}
#æ‰åŒ…ï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸»æˆåˆ†å›å½’
plc.fit = plsr(Y~X,scale = FALSE)
plc.beta = plc.fit$coefficients
plc.beta = rbind(c(0,0),plc.beta[,,1],plc.beta[,,2])
```

##æœ€ä¼˜å­é›†

```{r æœ€ä¼˜å­é›†}
#install.packages("leaps")
library(leaps)
#intercept  = FALSEè¡¨ç¤ºæ¨¡å‹ä¸åŒ…å«æˆªè·é¡¹
bs.fit = regsubsets(x=X,y=Y,intercept  = FALSE)
#coef(bs.fit,1)è¡¨ç¤ºç¬¬ä¸€ä¸ªæ¨¡å‹çš„å‚æ•°
if (summary(bs.fit)$which[1,1])
{
  bs.beta = c(coef(bs.fit,1),0)
}else{
  bs.beta = c(0,coef(bs.fit,1))#coefç”¨äºæå–ç³»æ•°
}
#ç¤ºæ²¡æœ‰å˜é‡è¯—çš„å‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ¨¡å‹å‚æ•°ï¼Œç¬¬äºŒä¸ªæ¨¡å‹å‚æ•°æŒ‰è¡Œç»„åˆèµ·æ¥
bs.beta = rbind(c(0, 0), bs.beta, coef(bs.fit, 2))
attr(bs.beta, "dimnames") = list(NULL,
                                c("X1","X2"))

```
##ç”»å›¾

```{r}
plot(0,0,
     type = "n",
     xlab = expression(beta[1]),
     ylab = expression(beta[2]),
     main = substitute(paste(rho," =",r),list(r = 0.5)),
     xlim = c(0,6),
     ylim = c(-1,3)
     )
par(lwd = 3,cex = 1)
lines(ridge.beta,col = "red")
lines(lasso.beta,col = "green")
lines(pcr.beta,col = "purple")
lines(plc.beta,col="orange")
lines(bs.beta,col = "blue")
points(ols.beta,col = "black",pch = 16)
abline(h = 0,lty = 2)
abline(v = 0,lty = 2)
legend(4.8,3,c("Ridge", "Lasso", "PCR", "PLS", "Best Subset", "Least Squares"),
         col = c("red", "green", "purple", "orange", "blue", "black"),
         lty = c(1,1,1,1,1,NA),
         pch =c(NA,NA,NA,NA,NA, 16),
         box.col = "white",
         box.lwd = 0,
         bg = "transparent")

```

